<!DOCTYPE html>
<html>
  <head>
    <title>dlux</title>
    <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.1/moment.min.js"></script>
    <script src="https://cdn.steemjs.com/lib/latest/steem.min.js"></script>
    <style>
      html, body{
      margin: 0;
      height: 100%;
      }
      iframe{
      border: 0;
      }
    </style>
    <script>
      if (isIOS()) {
      window.addEventListener('devicemotion', function(e) {
      document.getElementById('theIframe').contentWindow.postMessage({
      type: 'devicemotion',
      deviceMotionEvent: cloneDeviceMotionEvent(e),
      }, '*');
      });
      }
      function isIOS() {
      return /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
      }
      function cloneDeviceMotionEvent(e) {
      return {
      acceleration: {
      x: e.acceleration.x,
      y: e.acceleration.y,
      z: e.acceleration.z,
      },
      accelerationIncludingGravity: {
      x: e.accelerationIncludingGravity.x,
      y: e.accelerationIncludingGravity.y,
      z: e.accelerationIncludingGravity.z,
      },
      rotationRate: {
      alpha: e.rotationRate.alpha,
      beta: e.rotationRate.beta,
      gamma: e.rotationRate.gamma,
      },
      interval: e.interval,
      timeStamp: e.timeStamp
      };
      }
      if (window.addEventListener) {
      window.addEventListener("message", onMessage, false);
      }
      else if (window.attachEvent) {
      window.attachEvent("onmessage", onMessage, false);
      }
      function onMessage(event) {
      if (event.origin !== "https://cheerful-suggestion.glitch.me") return;
      var data = event.data;
      if (typeof(window[data.func]) == "function") {
      window[data.func].call(null, data.message);
      }
      }
      function vote(message) {
      var target = document.getElementById('theIframe').contentWindow
      target.postMessage({
      'func': 'voteMsg',
      'message': 'you sent a vote'
      }, "*");
      }


      function aVote(message) {
      var target = document.getElementById('theIframe').contentWindow
      target.postMessage({
      'func': 'voteMsg',
      'message': message
      }, "*");
      }

      function sendLink(link) {
      location.href = link;
        var target = document.getElementById('theIframe').contentWindow
      target.postMessage({
      'func': 'voteMsg',
      'message': 'you sent a vote'
      }, "*");
      }
      function iloaded(){
      steem.api.getState(`/dlux/@disregardfiat/mgrbow31o19wt1f8frk5jf75ssoxk24p`, (err, result) => {
      var target = document.getElementById('theIframe').contentWindow
      target.postMessage({
      'func': 'iAm',
      'message': 'Guest',
      }, "*");
      target.postMessage({
      'func': 'key',
      'message': 'disregardfiat/mgrbow31o19wt1f8frk5jf75ssoxk24p',
      }, "*");
      target.postMessage({
      'func': 'steemState',
      'message': result,
      }, "*");
      })
      }
    </script>
    <script>
      steem.api.getState(`/dlux/@disregardfiat/mgrbow31o19wt1f8frk5jf75ssoxk24p`, (err, result) => {
      console.log(result)
      var sux = 'disregardfiat/mgrbow31o19wt1f8frk5jf75ssoxk24p'
      var metadata = result.content[sux].json_metadata
      var hashy = JSON.parse(metadata).vrHash
      var iframe = document.createElement('iframe');
      iframe.allowvr = 'yes'
      iframe.id = 'theIframe'
      iframe.allowfullscreen = 'yes'
      iframe.scrolling = 'no'
      iframe.width = '100%'
      iframe.height = '100%'
      iframe.setAttribute('allow', 'gyroscope; accelerometer')
      iframe.src = 'https://cheerful-suggestion.glitch.me/post.html'
      document.body.appendChild(iframe);
      })
    </script>
    <body></body>
  </head>
</html>
